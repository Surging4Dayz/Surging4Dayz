var PurchaseFlow_Utils=function(){"use strict";var s=this;s.getCurrentOpenedModal=function(e){return e.querySelector(".active_modal")?e.querySelector(".active_modal").getAttribute("data-modal"):""},s.openSelectedModal=function(e,a){a.querySelector(".active_modal")&&MG_Utils.removeClass(a.querySelector(".active_modal"),"active_modal"),MG_Utils.addClass(a.querySelector(e),"active_modal")},s.addModalCloseListeners=function(l,t,r,i){i=void 0!==i?i:function(){};function a(e){if(MG_Utils.hasClass(l,"leave_confirmation")){var a="leave_confirmation_modal"==s.getCurrentOpenedModal(l)&&"close_button"===e;if("leave_confirmation_modal"!=s.getCurrentOpenedModal(l))l.querySelector(".leave_confirmation_modal .leave_confirmation_buttons").setAttribute("data-previousModal",s.getCurrentOpenedModal(l)),s.openSelectedModal(".leave_confirmation_modal",l);else if(a){var o=l.querySelector(".leave_confirmation_modal .leave_confirmation_buttons").getAttribute("data-previousModal");s.openSelectedModal("."+o,l)}}else r.closeModal(i),MG_Utils.hasClass(l,"reload_on_close")?t.dismissUrl?window.location.href=t.dismissUrl:window.location.reload(!0):MG_Utils.hasClass(l,"redirect_on_close")&&t.redirectWithoutParamsUrl&&(window.location.href=t.redirectWithoutParamsUrl)}MG_Utils.addEventHandler(document.querySelector("#modalWrapMTubes"),"click",function(e){"modalWrapMTubes"===(e.target&&e.target.id||e.srcElement&&e.srcElement.id)&&a("outer_close")}),[].forEach.call(l.querySelectorAll(".js_close_modal"),function(e){MG_Utils.addEventHandler(e,"click",function(){a("close_button")})})},s.addLeaveModalListeners=function(o,a,l,t){t=void 0!==t?t:function(){},MG_Utils.addEventHandler(o.querySelector(".js_cancel_leave_modal"),"click",function(e){var a=e.target.parentElement.getAttribute("data-previousModal");s.openSelectedModal("."+a,o)}),MG_Utils.addEventHandler(o.querySelector(".js_confirm_leave_modal"),"click",function(e){l.closeModal(t),MG_Utils.hasClass(e.target,"reload_on_close")&&(a.dismissUrl?window.location.href=a.dismissUrl:window.location.reload(!0))})},s.ageModal_triggerPurchaseFlow=function(){"undefined"!=typeof fanclubPurchaseFlowParams&&fanclubPurchaseFlowParams.triggerPurchaseFlow&&fanclubPurchaseFlowParams.modelId&&fanclubPurchaseFlow.triggerPurchaseModal(fanclubPurchaseFlowParams.modelId),"undefined"!=typeof customVideoPurchaseFlowParams&&customVideoPurchaseFlowParams.triggerCustomVideo&&customVideoPurchaseFlowParams.modelId&&customVideoPurchaseFlow.triggerPurchaseFlow(customVideoPurchaseFlowParams.modelId,!0),"undefined"!=typeof Tipping_PurchaseFlow_Params&&Tipping_PurchaseFlow_Params.isModelPage&&("#tip"===window.location.hash||0<window.location.search.indexOf("sendTip=1"))&&Tipping_PurchaseFlow_Params.modelUsername&&tippingPurchaseFlow.triggerPurchaseFlow(Tipping_PurchaseFlow_Params.modelUsername)},s.noAgeModal=function(e){var a=document.getElementById("js-ageDisclaimerModal")&&!getCookieAdvanced("accessAgeDisclaimerPH"),o=e.vkOauth_ageModal,l=e.utah_ageModal&&!getCookieAdvanced("accessPH");return!a&&!o&&!l}};try{var purchaseFlow_Utils=new PurchaseFlow_Utils}catch(e){console.log("ERROR === Purchase Flow Utils ==="),console.log(e)}
var FanclubPurchaseFlow=function(){"use strict";var s=this,r=[];s.defaultSettings={showSuccessModal:!1,showFailureModal:!1,dynamicallyTargetButton:!0,dismissUrl:""},s.init=function(e){s.params=MG_Utils.extendSimple(s.defaultSettings,e),s.initModals(),s.add_listeners()},s.initModals=function(){s.purchaseFlowModal=new MG_Modal({closeButton:!1,closeDocument:!1,content:document.querySelector(".fanclub_purchase_flow_modals_container"),className:"fanclubPurchaseFlowModal"})},s.removeInlineOnclick=function(e){[].forEach.call(e,function(e){var a=document.querySelectorAll(".modalMTubes ."+e);a&&[].forEach.call(a,function(e){s.buildOnclickEvent(e,e.getAttribute("data-ga")),e.onclick=null})})},s.buildOnclickEvent=function(e,a){if(r){for(var t=0;t<r.length;t++)if(r[t][a])return;var l={};l[a]=e.onclick,r.push(l)}},s.callGoogleAnalytics=function(t){r&&[].forEach.call(r,function(e){if(t.hasAttribute("data-ga")){var a=e[t.getAttribute("data-ga")];a&&a()}})},s.add_listeners=function(){if(s.params.dynamicallyTargetButton)MG_Utils.addEventHandler(document,"click",function(e){if(e.target){var a=e.target.parentNode,t=a?a.parentNode:null;MG_Utils.hasClass(e.target,"js_becomeFan")?s.triggerPurchaseModal(e.target.getAttribute("data-model_id")):a&&MG_Utils.hasClass(a,"js_becomeFan")?s.triggerPurchaseModal(a.getAttribute("data-model_id")):t&&MG_Utils.hasClass(t,"js_becomeFan")&&s.triggerPurchaseModal(t.getAttribute("data-model_id"))}});else{var e=document.querySelectorAll(".js_becomeFan");[].forEach.call(e,function(a){MG_Utils.addEventHandler(a,"click",function(e){s.triggerPurchaseModal(a.getAttribute("data-model_id"))})})}if(s.params.triggerPurchaseFlow&&s.params.isModelPage&&s.params.modelId&&purchaseFlow_Utils.noAgeModal()&&s.triggerPurchaseModal(s.params.modelId),s.params.showSuccessModal){s.purchaseFlowModal.openModal();var a=document.querySelector(".contentMTubes .fanclub_purchase_flow_modals");MG_Utils.addClass(a.querySelector(".pf_success_modal"),"active_modal"),MG_Utils.addClass(a,"redirect_on_close"),purchaseFlow_Utils.addModalCloseListeners(a,s.params,s.purchaseFlowModal)}if(s.params.showFailureModal){s.purchaseFlowModal.openModal();var t=(a=document.querySelector(".contentMTubes .fanclub_purchase_flow_modals")).querySelector(".pf_failure_modal");MG_Utils.addClass(t,"active_modal"),MG_Utils.addClass(a,"redirect_on_close"),purchaseFlow_Utils.addModalCloseListeners(a,s.params,s.purchaseFlowModal),MG_Utils.addEventHandler(t.querySelector(".js_change_cc"),"click",function(e){var a=e.target.getAttribute("data-model_id");MG_Utils.ajaxCall({type:"POST",data:{modelId:a},url:s.params.changeCCAjax,success:function(e){"PASS"==e.success&&(window.location.href=e.redirectUrl)}})})}},s.addNewEventHandlers=function(a,t){s.addLastDigitEventListeners(a),MG_Utils.addEventHandler(a.querySelector(".js_purchase_modal_submit"),"click",function(e){"true"==e.target.getAttribute("data-loginSignup")?(purchaseFlow_Utils.openSelectedModal(".login_signup_modal",a),purchaseFlow_LoginSignup.addListeners(a,t.showSignupCaptcha),s.removeInlineOnclick(["js_purchase_flow_login","js_purchase_flow_signup"])):(window.location.href=e.target.getAttribute("data-redirectUrl"),MG_Utils.addClass(e.target,"disabled"))}),MG_Utils.addEventHandler(a.querySelector(".js_report_other_perks"),"click",function(e){MG_Utils.hasClass(e.target,"disabled")||s.reportOtherPerks(e.target)});var e=a.querySelectorAll(".js_change_cc");[].forEach.call(e,function(e){MG_Utils.addEventHandler(e,"click",function(e){var a=e.target.getAttribute("data-model_id");MG_Utils.ajaxCall({type:"POST",data:{modelId:a},url:s.params.changeCCAjax,success:function(e){"PASS"==e.success&&(window.location.href=e.redirectUrl)}})})}),MG_Utils.addEventHandler(a.querySelector(".js_alreadyFanTip"),"click",function(e){s.purchaseFlowModal.closeModal(function(){window.location=e.target.getAttribute("data-url"),s.params.isModelPage&&!s.params.dismissUrl&&window.location.reload(!0)})}),purchaseFlow_Utils.addModalCloseListeners(a,s.params,s.purchaseFlowModal),purchaseFlow_Utils.addLeaveModalListeners(a,s.params,s.purchaseFlowModal)},s.addLastDigitEventListeners=function(r){var e=r.querySelectorAll(".lastFour");[].forEach.call(e,function(e){["keyup","input","keypress"].forEach(function(l){MG_Utils.addEventHandler(e,l,function(e){"input"==l&&1<=e.target.value.length&&(e.target.value=e.target.value.slice(0,1),MG_Utils.hasClass(e.target,"lastFourEnd")||e.target.nextElementSibling.focus());var a=r.querySelector("."+purchaseFlow_Utils.getCurrentOpenedModal(r)),t="";[].forEach.call(a.querySelectorAll(".lastFour"),function(e){t+=e.value}),"input"==l&&4==t.length&&MG_Utils.removeClass(a.querySelector(".js_last_digits_submit"),"disabled"),"keyup"!=l||"13"!=e.keyCode||MG_Utils.hasClass(a.querySelector(".js_last_digits_submit"),"disabled")||s.handleLastDigitsAjax(a,t)})})});var a=r.querySelectorAll(".js_last_digits_submit");[].forEach.call(a,function(l){MG_Utils.addEventHandler(l,"click",function(e){if(!MG_Utils.hasClass(l,"disabled")){MG_Utils.addClass(l,"disabled"),s.callGoogleAnalytics(l);var a=e.target.parentElement,t="";a.querySelectorAll(".lastFour").forEach(function(e){t+=e.value}),s.handleLastDigitsAjax(a,t)}})})},s.triggerPurchaseModal=function(t){s.purchaseFlowModal.openModal(function(){MG_Utils.addClass(document.querySelector(".modalMTubes.fanclubPurchaseFlowModal"),"loadingModal"),MG_Utils.ajaxCall({type:"POST",data:{modelId:t},url:s.params.initiatePurchaseFlowAjax,success:function(e){if(MG_Utils.removeClass(document.querySelector(".modalMTubes.fanclubPurchaseFlowModal"),"loadingModal"),"PASS"==e.success){var a=document.querySelector(".contentMTubes .fanclub_purchase_flow_modals");MG_Utils.addClass(a.querySelector(".fanclub_purchase_modal"),"active_modal"),s.populatePurchaseModal(e,a),s.replaceModelInfo(e,a,t),s.addNewEventHandlers(a,e),document.querySelector('div[data-ga="purchase_logged_in"]')&&s.removeInlineOnclick(["js_last_digits_submit"]),s.initScroll(a.querySelectorAll(".fanclub_purchase_top_content"),"100%","250px")}else if(void 0!==e.fanclubInactive&&e.fanclubInactive){a=document.querySelector(".contentMTubes .fanclub_purchase_flow_modals");MG_Utils.addClass(a.querySelector(".inactive_fanclub_modal"),"active_modal"),a.innerHTML=a.innerHTML.replace(/%%MODEL_NAME%%/g,'<span class="modelName">'+e.username+"</span>"),purchaseFlow_Utils.addModalCloseListeners(a,s.params,s.purchaseFlowModal)}}})})},s.populatePurchaseModal=function(e,t){e.perks&&e.perks.forEach(function(e){var a=t.querySelector(".perks_template .perk_container").cloneNode(!0);a.querySelector(".perk_content").innerText=e,t.querySelector(".fanclub_purchase_perks_list").appendChild(a)}),e.otherPerks&&(e.otherPerks.forEach(function(e){var a=t.querySelector(".perks_template .perk_container").cloneNode(!0);a.querySelector(".perk_content").innerText=e,t.querySelector(".fanclub_purchase_other_perks_list").appendChild(a)}),MG_Utils.addClass(t.querySelector(".fanclub_purchase_other_perks"),"active"),MG_Utils.addClass(t.querySelector(".fanclub_purchase_top_content"),"two_perks_list")),e.showLast4?MG_Utils.addClass(t.querySelector(".fanclub_purchase_bottom"),"purchase_modal_2"):MG_Utils.addClass(t.querySelector(".fanclub_purchase_bottom"),"purchase_modal_1"),e.loginSignup&&t.querySelector(".js_purchase_modal_submit").setAttribute("data-loginSignup",!0),void 0!==e.redirectUrl&&t.querySelector(".js_purchase_modal_submit").setAttribute("data-redirectUrl",e.redirectUrl),void 0!==e.paidVideoOptOutMessage&&e.paidVideoOptOutMessage&&(t.querySelector(".fanclub_purchase_optout").innerHTML=e.paidVideoOptOutMessage)},s.replaceModelInfo=function(e,a,t){var l=e.modelInfo.modelName,r=e.modelInfo.priceFrequency;a.innerHTML=a.innerHTML.replace(/FANCLUB_PRICE/g,r),a.innerHTML=a.innerHTML.replace(/MODEL_ID/g,t),[].forEach.call(a.querySelectorAll(".modelName"),function(e){e.innerText=l})},s.reportOtherPerks=function(a){var e=a.getAttribute("data-model_id");MG_Utils.ajaxCall({type:"POST",data:{modelId:e},url:s.params.reportOtherPerksAjax,success:function(e){"PASS"==e.success?(a.innerHTML=s.params.reportOtherPerksThankYouTxt,MG_Utils.addClass(a,"notClickable"),MG_Utils.addClass(a,"disabled")):"FAIL"==e.success&&(a.innerHTML=e.message,MG_Utils.addClass(a,"notClickable"),MG_Utils.addClass(a,"disabled"),MG_Utils.addClass(a,"error"))}})},s.handleLastDigitsAjax=function(a,e){MG_Utils.removeClass(a.querySelector(".last_digits_error"),"active"),a.querySelector(".last_digits_error").innerHTML="";var t={last4:e,modelId:a.querySelector(".js_last_digits_submit").getAttribute("data-model_id")};s.params.premiumUserInfo&&(t.a=s.params.premiumUserInfo),MG_Utils.ajaxCall({type:"POST",data:t,url:s.params.lastDigitsAjax,success:function(e){"FAIL"==e.success?(MG_Utils.addClass(a.querySelector(".last_digits_error"),"active"),a.querySelector(".last_digits_error").innerHTML=e.message):window.location.href=e.redirectUrl}})},s.initScroll=function(e,a,t){MG_Scroll.init({selector:e,width:a,height:t,color:"#F39000",railColor:"#2e2e2e",railOpacity:"1",opacity:"1",wrapperClass:"scrollContentWrapper"})},s.handleAfterLoginSignup=function(e,a,t,l){if(t=void 0!==t&&t,l=void 0!==l&&l,document.querySelector('div[data-ga="login"]')&&s.callGoogleAnalytics(document.querySelector('div[data-ga="login"]')),t){purchaseFlow_Utils.openSelectedModal(".last_digits_modal",e);var r=e.querySelector(".last_digits_modal");r.querySelector(".last_digits_avatar").setAttribute("src",a.thumbnail),r.querySelector(".last_digits_top_username").innerHTML=a.username,document.querySelector('div[data-ga="purchase_after_login"]')&&s.removeInlineOnclick(["js_last_digits_submit"]),void 0!==a.dismissUrl&&(s.params.dismissUrl=a.dismissUrl),void 0!==a.responseData&&void 0!==a.responseData.autoLoginParameter&&(s.params.premiumUserInfo=a.responseData.autoLoginParameter),MG_Utils.addClass(e,"leave_confirmation"),MG_Utils.addClass(e.querySelector(".js_confirm_leave_modal"),"reload_on_close")}else l?(purchaseFlow_Utils.openSelectedModal(".already_fan_modal",e),e.querySelector(".already_fan_send_tip").setAttribute("data-url",a.tipUrl),MG_Utils.removeClass(e,"leave_confirmation"),MG_Utils.addClass(e,"reload_on_close"),void 0!==a.dismissUrl&&(s.params.dismissUrl=a.dismissUrl),void 0!==a.responseData&&void 0!==a.responseData.autoLoginParameter&&(s.params.premiumUserInfo=a.responseData.autoLoginParameter)):void 0!==a.redirectUrl&&(window.location.href=a.redirectUrl)}};try{var fanclubPurchaseFlow=new FanclubPurchaseFlow;fanclubPurchaseFlow.init("undefined"!=typeof fanclubPurchaseFlowParams?fanclubPurchaseFlowParams:{})}catch(e){console.log("ERROR === Fanclub Purchase Flow ==="),console.log(e)}
var PurchaseFlow_LoginSignup=function(){"use strict";var n=this;n.defaultSettings={timer:null,idleTime:500,signup_errors:{}},n.init=function(e){n.params=MG_Utils.extendSimple(n.defaultSettings,e)},n.addListeners=function(s,e){!e&&"true"!=e||MG_Utils.addClass(s.querySelector(".pf_signup_recaptcha"),"active"),MG_Utils.addClass(s,"leave_confirmation"),s.querySelector(".js_cancel_leave_modal").parentElement.setAttribute("data-previousModal","login_signup_modal");var i=s.querySelectorAll(".login_signup_tabs_item");[].forEach.call(i,function(e){MG_Utils.addEventHandler(e,"click",function(e){MG_Utils.removeClassMultiple(i,"active_tab"),MG_Utils.addClass(e.target,"active_tab");var r=s.querySelectorAll(".login_signup_content_wrap .login_signup_content"),a=s.querySelector("#"+e.target.getAttribute("data-tabid"));MG_Utils.removeClassMultiple(r,"active"),MG_Utils.addClass(a,"active")})}),n.addLoginListeners(s),n.addSignupListeners(s),n.signup_initCaptcha(s)},n.addLoginListeners=function(a){MG_Utils.addEventHandler(a.querySelector(".js_purchase_flow_login"),"click",function(e){MG_Utils.hasClass(e.target,"disabled")||(MG_Utils.addClass(e.target,"disabled"),n.handleLoginAjax(a,e.target))});var e=a.querySelectorAll(".pf_login_input");[].forEach.call(e,function(e){["keyup","input","keypress"].forEach(function(r){MG_Utils.addEventHandler(e,r,function(e){""!=a.querySelector(".js_pf_login_username").value&&""!=a.querySelector(".js_pf_login_password").value&&(MG_Utils.removeClass(a.querySelector(".js_purchase_flow_login"),"disabled"),"keyup"==r&&"13"==e.keyCode&&(MG_Utils.addClass(e.target,"disabled"),n.handleLoginAjax(a,a.querySelector(".js_purchase_flow_login"))))})})})},n.addSignupListeners=function(s){n.signupInputs={email:s.querySelector(".js_pf_signup_email"),username:s.querySelector(".js_pf_signup_username"),password:s.querySelector(".js_pf_signup_password")},["keyup","input","keypress"].forEach(function(a){["email","username","password"].forEach(function(r){MG_Utils.addEventHandler(n.signupInputs[r],a,function(e){""!=e.target.value&&(n.signup_isInputValid(r,e.target,s)&&n.idleTimeoutValidation(function(){n.signup_backendCheckSetup(e.target,r,s)}),"keyup"!=a||"13"!=e.keyCode||MG_Utils.hasClass(s.querySelector(".js_purchase_flow_signup"),"disabled")||n.signup_submitAjax(s.querySelector(".js_purchase_flow_signup"),s))})})}),["email","username","password"].forEach(function(r){MG_Utils.addEventHandler(n.signupInputs[r],"focus",function(e){""!=e.target.value&&n.params.signup_errors[r]&&(s.querySelector(".fanclub_signup_form .error_message").innerHTML=n.params.signup_errors[r])})}),MG_Utils.addEventHandler(s.querySelector(".js_purchase_flow_signup"),"click",function(e){MG_Utils.hasClass(e.target,"disabled")||(MG_Utils.addClass(e.target,"disabled"),n.signup_submitAjax(e.target,s))})},n.handleLoginAjax=function(s,i,e,t){e=void 0!==e&&e,t=void 0!==t&&t;var r={token:n.params.token,username:s.querySelector(".js_pf_login_username").value,password:s.querySelector(".js_pf_login_password").value,remember_me:s.querySelector(".js_pf_login_remember").checked,modelId:i.getAttribute("data-model_id"),login:1,redirect:s.querySelector(".js_pf_login_redirect").value,pageUser:s.querySelector(".js_pf_login_pageUser").value};e&&(r=MG_Utils.extendSimple(r,e)),MG_Utils.ajaxCall({type:"POST",url:i.getAttribute("data-submit_url"),data:r,success:function(e){var r=i.getAttribute("data-purchase_flow_type");if(MG_Utils.removeClassMultiple(s.querySelectorAll(".error_message"),"active"),MG_Utils.removeClassMultiple(s.querySelectorAll(".pf_login_input"),"error"),[].forEach.call(s.querySelectorAll(".error_message"),function(e){e.innerHTML=""}),void 0!==e.twoStepVerification&&e.twoStepVerification)MG_Utils.addClass(s.querySelector(".pf_login_form"),"hide"),MG_Utils.addClass(s.querySelector(".pf_login_verification"),"active"),(a=s.querySelector(".pf_login_verification")).querySelector("#loginPageVerificationEnabledUsername").value=e.username,a.querySelector("#verificationEnabledToken").value=e.autoLoginParameter,a.querySelector("#loginPageAuthyId").value=e.authyId,a.querySelector(".pf_verify_userNumber").innerText=e.phoneNumber,n.loginVerification_addListeners(s,a);else if("1"===e.success||"PASS"==e.success)t?MG_Utils.addClass(s.querySelector(".pf_verify_message"),"active"):MG_Utils.addClass(s.querySelector(".fanclub_login_form .success_message"),"active"),"fanclub"==r?fanclubPurchaseFlow.handleAfterLoginSignup(s,e,e.last4Required,e.isAlreadyFan):"customVideo"==r?customVideoPurchaseFlow.handleAfterLoginSignup(s,e,e.last4Required):"tipping"==r?tippingPurchaseFlow.handleAfterLoginSignup(s,e,e.last4Required):"videoPurchase"==r&&videoPurchaseFlow.handleAfterLoginSignup(s,e,e.last4Required);else if(t){if(void 0!==e.message&&e.message){var a=s.querySelector(".pf_login_verification");MG_Utils.addClass(a.querySelector(".pf_verify_message_error"),"active"),a.querySelector(".pf_verify_message_error").innerText=e.message}}else s.querySelector(".fanclub_login_form .error_message").innerHTML=e.message,MG_Utils.addClass(s.querySelector(".fanclub_login_form .error_message"),"active"),MG_Utils.addClassMultiple(s.querySelectorAll(".pf_login_input"),"error")}})},n.loginVerification_addListeners=function(a,s){var i=s.querySelector(".pf_login_verificationCode");["keyup","input","keypress"].forEach(function(r){MG_Utils.addEventHandler(i,r,function(e){"input"==r&&0<i.value.length&&MG_Utils.removeClass(s.querySelector(".js_pfVerifySubmit"),"disabled"),"keyup"!=r||"13"!=e.keyCode||MG_Utils.hasClass(s.querySelector(".js_pfVerifySubmit"),"disabled")||n.loginVerification_submit(a,s,s.querySelector(".js_pfVerifySubmit")),0===i.value.length&&MG_Utils.addClass(s.querySelector(".js_pfVerifySubmit"),"disabled")})});var r=s.querySelector(".js_pfVerifySubmit");MG_Utils.addEventHandler(r,"click",function(e){MG_Utils.hasClass(r,"disabled")||n.loginVerification_submit(a,s,r)}),MG_Utils.addEventHandler(s.querySelector(".js_pfVerifyResendCode"),"click",function(e){s.querySelector(".pf_verify_resend_msg").innerText="",MG_Utils.removeClass(s.querySelector(".pf_verify_resend_msg"),"active"),MG_Utils.ajaxCall({type:"POST",data:{authyId:s.querySelector("#loginPageAuthyId").value,token:n.params.token},url:n.params.twoStepResendUrl,success:function(e){"success"==e.status?void 0!==e.message&&e.message&&(s.querySelector(".pf_verify_resend_msg").innerText=e.message,MG_Utils.addClass(s.querySelector(".pf_verify_resend_msg"),"active")):void 0!==e.message&&e.message&&(MG_Utils.addClass(s.querySelector(".pf_verify_message_error"),"active"),s.querySelector(".pf_verify_message_error").innerText=e.message)}})})},n.loginVerification_submit=function(e,r,a){var s={username:r.querySelector("#loginPageVerificationEnabledUsername").value,token2:r.querySelector("#verificationEnabledToken").value,verification_modal:1,authyId:r.querySelector("#loginPageAuthyId").value,token:n.params.token,verification_code:r.querySelector(".pf_login_verificationCode").value};n.handleLoginAjax(e,a,s,!0)},n.signup_backendCheckSetup=function(e,r,a){n.signup_ajaxCheck(e,r,e.value,a)},n.signup_hideError=function(e,r,a){MG_Utils.removeClass(e,"invalid"),n.params.signup_errors[r]&&delete n.params.signup_errors[r],0<Object.keys(n.params.signup_errors).length?a.querySelector(".fanclub_signup_form .error_message").innerHTML=n.params.signup_errors[Object.keys(n.params.signup_errors)[0]]:(MG_Utils.removeClass(a.querySelector(".fanclub_signup_form .error_message"),"active"),a.querySelector(".fanclub_signup_form .error_message").innerHTML="")},n.signup_ajaxCheck=function(r,a,e,s){var i={token:n.params.token,redirect:"",check_what:a};i[a]=e,MG_Utils.ajaxCall({type:"POST",url:n.params.checkInputAjax,data:i,success:function(e){""!==e.error_message?n.signup_putError(r,a,e.error_message,s):(n.signup_makeElementValid(r,a,s),n.signup_validateForm(s))},error:function(){console.log("Network Error!")}})},n.idleTimeoutValidation=function(e){n.params.timer&&clearTimeout(n.params.timer),n.params.timer=setTimeout(function(){e()},n.params.idleTime)},n.signup_isInputValid=function(e,r,a){switch(e){case"email":return n.signup_isEmailValid(r,a);case"username":return n.signup_isUsernameValid(r,a);case"password":return n.signup_isPasswordValid(r,a)}},n.signup_isEmailValid=function(e,r){return/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e.value)?e.value.length<5?(n.signup_putError(e,"email",n.params.errorMsg.emailTooShort,r),!1):!(50<e.value.length)||(n.signup_putError(e,"email",n.params.errorMsg.emailTooLong,r),!1):(n.signup_putError(e,"email",n.params.errorMsg.invalidEmail,r),!1)},n.signup_isUsernameValid=function(e,r){var a=r.querySelector(".js_pf_signup_password");return e.value.length<5?(n.signup_putError(e,"username",n.params.errorMsg.usernameTooShort,r),!1):18<e.value.length?(n.signup_putError(e,"username",n.params.errorMsg.usernameTooLong,r),!1):""==a.value||a.value!=e.value||(n.signup_putError(e,"username",n.params.errorMsg.usernamePasswordcantMatch,r),!1)},n.signup_isPasswordValid=function(e,r){var a=r.querySelector(".js_pf_signup_username");return e.value.length<6?(n.signup_putError(e,"password",n.params.errorMsg.passwordTooShort,r),!1):40<e.value.length?(n.signup_putError(e,"password",n.params.errorMsg.passwordTooLong,r),!1):""==a.value||a.value!=e.value||(n.signup_putError(e,"password",n.params.errorMsg.usernamePasswordcantMatch,r),!1)},n.signup_putError=function(e,r,a,s){a=void 0!==a?a:"",MG_Utils.addClass(s.querySelector(".js_purchase_flow_signup"),"disabled"),MG_Utils.removeClass(e,"valid"),MG_Utils.addClass(e,"invalid"),e.setAttribute("data-valid",!1),(n.params.signup_errors[r]=a)?(s.querySelector(".fanclub_signup_form .error_message").innerHTML=a,MG_Utils.addClass(s.querySelector(".fanclub_signup_form .error_message"),"active")):n.signup_getError(r,s)},n.signup_getError=function(e,r){n.params.signup_errors[e]&&(r.querySelector(".fanclub_signup_form .error_message").innerHTML=n.params.signup_errors[e],r.querySelector(".fanclub_signup_form .error_message").style.opacity=1)},n.signup_makeElementValid=function(e,r,a){MG_Utils.removeClass(e,"invalid"),MG_Utils.addClass(e,"valid"),e.setAttribute("data-valid",!0),n.signup_hideError(e,r,a)},n.signup_validateForm=function(e){var r=!1,a=!MG_Utils.hasClass(e.querySelector(".pf_signup_recaptcha"),"active");"true"==e.querySelector(".js_pf_signup_email").getAttribute("data-valid")&&"true"==e.querySelector(".js_pf_signup_username").getAttribute("data-valid")&&"true"==e.querySelector(".js_pf_signup_password").getAttribute("data-valid")&&(r=!0),MG_Utils.hasClass(e.querySelector(".pf_signup_recaptcha"),"active")&&(a=!!recaptchaComplete),r&&a?MG_Utils.removeClass(e.querySelector(".js_purchase_flow_signup"),"disabled"):MG_Utils.addClass(e.querySelector(".js_purchase_flow_signup"),"disabled")},n.signup_initCaptcha=function(e){if(0==document.querySelectorAll('script[src="https://www.google.com/recaptcha/api.js?onload=initCaptcha&render=explicit"]').length){var r=document.createElement("script");r.setAttribute("src","https://www.google.com/recaptcha/api.js?onload=initCaptcha&render=explicit"),r.setAttribute("type","text/javascript"),r.setAttribute("async",""),r.setAttribute("defer",""),document.head.appendChild(r)}},n.signup_submitAjax=function(a,s){var e=n.signupInputs.email.value,r=n.signupInputs.username.value,i=n.signupInputs.password.value;MG_Utils.ajaxCall({type:"POST",url:a.getAttribute("data-submit_url"),data:{token:n.params.token,email:e,username:r,password:i,modelId:a.getAttribute("data-model_id"),signup:1,pageUser:s.querySelector(".js_pf_signup_pageUser").value},success:function(e){if("PASS"==e.success||"1"===e.success){var r=a.getAttribute("data-purchase_flow_type");"fanclub"==r?fanclubPurchaseFlow.handleAfterLoginSignup(s,e):"customVideo"==r?customVideoPurchaseFlow.handleAfterLoginSignup(s,e):"tipping"==r?tippingPurchaseFlow.handleAfterLoginSignup(s,e):"videoPurchase"==r&&videoPurchaseFlow.handleAfterLoginSignup(s,e)}else s.querySelector(".fanclub_signup_form .error_message").innerHTML=e.message,e.showSignupCaptcha&&MG_Utils.addClass(s.querySelector(".pf_signup_recaptcha"),"active")}})}};try{var purchaseFlow_LoginSignup=new PurchaseFlow_LoginSignup;purchaseFlow_LoginSignup.init("undefined"!=typeof purchaseFlow_LoginSignup_Params?purchaseFlow_LoginSignup_Params:{})}catch(e){console.log("ERROR === Login / Signup Modal ==="),console.log(e)}if("function"!=typeof initCaptcha){function initCaptcha(){var e=document.querySelectorAll(".g-recaptcha");if(0<e.length)for(var r=0;r<e.length;r++)grecaptcha.render(e[r],{sitekey:purchaseFlow_LoginSignup_Params.signupSitekey,theme:"dark",callback:verifiedCallback})}var recaptchaComplete;function verifiedCallback(){recaptchaComplete=!0,document.querySelector(".modalMTubes .login_signup_modal")&&purchaseFlow_LoginSignup.signup_validateForm(document.querySelector(".modalMTubes .login_signup_modal"))}}
var TippingPurchaseFlow=function(){"use strict";var r=this;r.defaultSettings={showSuccessModal:!1,showFailureModal:!1,dismissUrl:"",tipButton_Class:"js-tipsTrigger",triggerPurchaseFlow:!1,submodal_class:".tipping_submodal",showSignupCaptcha:!1,modelUsername:"",vkey:!1,dynamicallyTargetButton:!1,modelId:""},r.init=function(e){r.params=MG_Utils.extendSimple(r.defaultSettings,e),r.initModals(),r.add_listeners()},r.initModals=function(){r.purchaseFlowModal=new MG_Modal({closeButton:!1,closeDocument:!1,content:document.querySelector(".tipping_modals_container"),className:"tippingPurchaseFlowModal"})},r.add_listeners=function(){if(r.params.dynamicallyTargetButton)MG_Utils.addEventHandler(document,"click",function(e){if(e.target){var a=e.target.parentNode,t=a?a.parentNode:null;MG_Utils.hasClass(e.target,r.params.tipButton_Class)?r.triggerPurchaseFlow(e.target.getAttribute("data-model"),e.target.getAttribute("data-model_id")):a&&MG_Utils.hasClass(a,r.params.tipButton_Class)?r.triggerPurchaseFlow(a.getAttribute("data-model"),a.getAttribute("data-model_id")):t&&MG_Utils.hasClass(t,r.params.tipButton_Class)&&r.triggerPurchaseFlow(t.getAttribute("data-model"),t.getAttribute("data-model_id"))}});else{var e=document.querySelectorAll("."+r.params.tipButton_Class);[].forEach.call(e,function(a){MG_Utils.addEventHandler(a,"click",function(e){a.getAttribute("data-model")&&r.triggerPurchaseFlow(a.getAttribute("data-model"),a.getAttribute("data-model_id"))})})}if(("#tip"===window.location.hash||0<window.location.search.indexOf("sendTip=1"))&&r.params.isModelPage&&purchaseFlow_Utils.noAgeModal(r.params)&&r.triggerPurchaseFlow(r.params.modelUsername,r.params.modelId),r.params.showSuccessModal){r.purchaseFlowModal.openModal();var a=document.querySelector(".modalMTubes.tippingPurchaseFlowModal");MG_Utils.addClass(a.querySelector(".pf_success_modal"),"active_modal"),MG_Utils.addClass(a,"redirect_on_close"),purchaseFlow_Utils.addModalCloseListeners(a,r.params,r.purchaseFlowModal),a.querySelector(".js_successTipPrice").innerHTML=r.params.transactionTipAmount}if(r.params.showFailureModal){r.purchaseFlowModal.openModal();var t=(a=document.querySelector(".modalMTubes.tippingPurchaseFlowModal")).querySelector(".pf_failure_modal");MG_Utils.addClass(t,"active_modal"),MG_Utils.addClass(a,"redirect_on_close"),purchaseFlow_Utils.addModalCloseListeners(a,r.params,r.purchaseFlowModal),MG_Utils.addEventHandler(a.querySelector(".js-retryPurchase"),"click",function(){r.params.selectedTipAmount=r.params.transactionTipAmount,r.sendTipsAjax(a,!0)})}},r.addNewEventHandlers=function(s){r.addTippingModalListeners(s),purchaseFlow_Utils.addModalCloseListeners(s,r.params,r.purchaseFlowModal),purchaseFlow_Utils.addLeaveModalListeners(s,r.params,r.purchaseFlowModal),MG_Utils.addEventHandler(s.querySelector(".js_tipCheckout"),"click",function(e){MG_Utils.addClass(e.target,"disabled"),r.sendTipsAjax(s)});var e=s.querySelectorAll(".lastFour");[].forEach.call(e,function(e){["keyup","input","keypress"].forEach(function(l){MG_Utils.addEventHandler(e,l,function(e){"input"==l&&1<=e.target.value.length&&(e.target.value=e.target.value.slice(0,1),MG_Utils.hasClass(e.target,"lastFourEnd")||e.target.nextElementSibling.focus());var a=s.querySelector(".js_tipCheckoutDigits"),t="";[].forEach.call(s.querySelectorAll(".lastFour"),function(e){t+=e.value}),"input"==l&&4==t.length&&MG_Utils.removeClass(a,"disabled"),"keyup"!=l||"13"!=e.keyCode||MG_Utils.hasClass(a,"disabled")||r.sendTipsAjax(s,!1,t)})})}),MG_Utils.addEventHandler(s.querySelector(".js_tipCheckoutDigits"),"click",function(e){var a="";[].forEach.call(s.querySelectorAll(".lastFour"),function(e){a+=e.value}),MG_Utils.addClass(e.target,"disabled"),r.sendTipsAjax(s,!1,a)}),[].forEach.call(s.querySelectorAll(".js_changeCC"),function(e){MG_Utils.addEventHandler(e,"click",function(){r.sendTipsAjax(s,!0)})})},r.addTippingModalListeners=function(a){var t=a.querySelector(".js-tipsModal"),e=t.querySelectorAll(".inputBox label");[].forEach.call(e,function(e){MG_Utils.addEventHandler(e,"click",function(e){var a=t.querySelector(".js_tippingModalCheckout");a&&MG_Utils.removeClass(a,"disabled")})}),MG_Utils.addEventHandler(t.querySelector(".js_tippingModalCheckout"),"click",function(e){e.preventDefault(),r.submitTippingModal(a)});var l=t.querySelector(".js-tipOther"),s=t.querySelector(".tipOtherCaption");MG_Utils.addEventHandler(l,"click",function(e){s.querySelector(".tipAmount").style.display="none",s.querySelector(".inputTipOther").style.display="block"}),MG_Utils.addEventHandler(s.querySelector(".inputTipOther"),"keydown",function(e){13==e.keyCode&&(e.preventDefault(),r.submitTippingModal(a))})},r.triggerPurchaseFlow=function(a,t){r.purchaseFlowModal.openModal(function(){var e=document.querySelector(".modalMTubes.tippingPurchaseFlowModal .tipping_modals_wrapper");purchaseFlow_Utils.openSelectedModal(".js-tipsModal",e),r.params.modelUsername=a,r.params.modelId=t,e.innerHTML=e.innerHTML.replace(/MODEL_ID/g,t),r.addNewEventHandlers(e),[].forEach.call(e.querySelectorAll(".tippedModel"),function(e){e.innerHTML=r.params.modelUsername})})},r.submitTippingModal=function(e){var a=e.querySelector(".js_tippingModalCheckout");!MG_Utils.hasClass(a,"disabled")&&r.validateTipValue(e)&&(r.params.selectedTipAmount=e.querySelector('.tips .inputBox input[type="radio"]:checked').getAttribute("data-value"),[].forEach.call(e.querySelectorAll(".modelTipAmount"),function(e){e.innerHTML=r.params.selectedTipAmount}),r.params.liu?(r.params.last4?purchaseFlow_Utils.openSelectedModal(".js-tipsDigits",e):purchaseFlow_Utils.openSelectedModal(".js-tipsNoDigits",e),MG_Utils.addClass(e,"leave_confirmation")):(purchaseFlow_Utils.openSelectedModal(".login_signup_modal",e),purchaseFlow_LoginSignup.addListeners(e,r.params.showSignupCaptcha)))},r.validateTipValue=function(e){var a=!0,t=e.querySelector('.tips .inputBox input[type="radio"]:checked');if(t){var l=t.parentElement;if(MG_Utils.hasClass(t,"js-tipOther")){var s=l.querySelector(".inputTipOther").value;if(/^\d+$/.test(s)){var r=parseInt(s);a=0<r&&r<=150}else a=!1;a?(MG_Utils.removeClass(l.querySelector(".inputTipOther"),"error"),t.setAttribute("data-value",s)):(MG_Utils.addClass(l.querySelector(".inputTipOther"),"error"),l.querySelector(".inputTipOther").value="")}return a}return!1},r.handleAfterLoginSignup=function(e,a,t){t=void 0!==t&&t,void 0!==a.liuIsOwner&&a.liuIsOwner?window.location.reload(!0):(void 0!==a.newToken&&a.newToken&&(r.params.token=a.newToken),t?purchaseFlow_Utils.openSelectedModal(".js-tipsDigits",e):purchaseFlow_Utils.openSelectedModal(".js-tipsNoDigits",e),MG_Utils.addClass(e,"leave_confirmation"),MG_Utils.addClass(e.querySelector(".js_confirm_leave_modal"),"reload_on_close"),void 0!==a.dismissUrl&&(r.params.dismissUrl=a.dismissUrl),void 0!==a.al&&(r.params.premiumUserInfo=a.al))},r.sendTipsAjax=function(t,e,a){e=void 0!==e&&e,a=void 0!==a&&a;var l={amount:r.params.selectedTipAmount,username:r.params.modelUsername,token:r.params.token,modelId:r.params.modelId};r.params.viewkey&&(l.viewkey=r.params.viewkey),r.params.premiumUserInfo&&(l.al=r.params.premiumUserInfo),e&&(l.newCC=1),a&&(l.last4=a),r.params.isChat&&(l.isChat=1),MG_Utils.ajaxCall({url:r.params.sendTipUrl,type:"POST",data:l,success:function(e){var a=t.querySelector("."+purchaseFlow_Utils.getCurrentOpenedModal(t));e.error?a.querySelector(".js_sendTipError")&&(a.querySelector(".js_sendTipError").innerHTML=e.message):(a.querySelector(".js_sendTipError")&&(a.querySelector(".js_sendTipError").innerHTML=""),window.location.href=e.redirectUrl)}})}};try{var tippingPurchaseFlow=new TippingPurchaseFlow;tippingPurchaseFlow.init("undefined"!=typeof Tipping_PurchaseFlow_Params?Tipping_PurchaseFlow_Params:{})}catch(e){console.log("ERROR === Tipping Purchase Flow ==="),console.log(e)}
var VideoPurchaseFlow=function(){"use strict";var i=this;i.defaultSettings={showSuccessModal:!1,showFailureModal:!1,dismissUrl:"",buyVideoButton:".js-purchaseButton",submodal_class:".videoPurchase_submodal",showSignupCaptcha:!1},i.init=function(e){i.params=MG_Utils.extendSimple(i.defaultSettings,e),i.initModals(),i.add_listeners()},i.initModals=function(){i.purchaseFlowModal=new MG_Modal({closeButton:!1,closeDocument:!1,content:document.querySelector(".video_purchase_modals_container"),className:"videoPurchaseFlowModal"})},i.add_listeners=function(){var e=document.querySelectorAll(i.params.buyVideoButton);if([].forEach.call(e,function(e){MG_Utils.addEventHandler(e,"click",function(e){i.triggerPurchaseFlow()})}),i.params.showSuccessModal){i.purchaseFlowModal.openModal();var a=document.querySelector(".modalMTubes.videoPurchaseFlowModal");MG_Utils.addClass(a.querySelector(".pf_success_modal"),"active_modal"),MG_Utils.addClass(a,"redirect_on_close"),purchaseFlow_Utils.addModalCloseListeners(a,i.params,i.purchaseFlowModal),ga("send","event","Success Modal","click","Click on modal")}if(i.params.showFailureModal){i.purchaseFlowModal.openModal();a=document.querySelector(".modalMTubes.videoPurchaseFlowModal");MG_Utils.addClass(a.querySelector(".pf_failure_modal"),"active_modal"),MG_Utils.addClass(a,"redirect_on_close"),purchaseFlow_Utils.addModalCloseListeners(a,i.params,i.purchaseFlowModal),ga("send","event","Transaction Failed Modal","click","Modal Shown"),MG_Utils.addEventHandler(a.querySelector(".pf_failure_modal").querySelector(".js_change_cc"),"click",function(){MG_Utils.ajaxCall({url:i.params.tryAgainUrl,type:"POST",success:function(e){e.error&&"PASS"!=e.success||(window.location.href=e.redirectUrl)}})})}},i.triggerPurchaseFlow=function(){i.purchaseFlowModal.openModal(function(){var l=document.querySelector(".modalMTubes.videoPurchaseFlowModal");if(i.params.last4?(purchaseFlow_Utils.openSelectedModal(".js-purchaseDigitsModal",l),i.addPurchaseDigitsModalListeners(l)):purchaseFlow_Utils.openSelectedModal(".js-purchaseModal",l),l.querySelector(".js-purchaseVideoButton")){var e=l.querySelectorAll(".js-purchaseVideoButton");[].forEach.call(e,function(a){MG_Utils.addEventHandler(a,"click",function(e){a.setAttribute("disabled",!0),i.params.liu?i.digitsValidation(l,e,a):(purchaseFlow_Utils.openSelectedModal(".login_signup_modal",l),purchaseFlow_LoginSignup.addListeners(l,i.params.showSignupCaptcha))})})}if(l.querySelector(".js-purchaseCreditCard")){e=l.querySelectorAll(".js-purchaseCreditCard");[].forEach.call(e,function(a){MG_Utils.addEventHandler(a,"click",function(e){a.setAttribute("disabled",!0),i.probillerAjax(l,i.params.probillerCreditCard,a)})})}purchaseFlow_Utils.addModalCloseListeners(l,i.params,i.purchaseFlowModal),purchaseFlow_Utils.addLeaveModalListeners(l,i.params,i.purchaseFlowModal)})},i.addPurchaseDigitsModalListeners=function(e){var a=e.querySelector(".js_videoPurchaseDigits");a&&a.addEventListener("input",function(e){if(e.target!==e.currentTarget){var a=e.currentTarget.querySelector(".js-purchaseVideoDigitsButton");Number.isInteger(parseFloat(e.target.value))?1<e.target.value.length?e.target.value=e.target.value.replace(e.target.value.charAt(1),""):""!=e.target.value&&(MG_Utils.addClass(e.target,"full"),MG_Utils.nextElementSibling(e.target).focus()):(e.target.value="",MG_Utils.removeClass(e.target,"full"),MG_Utils.removeClass(a,"disabled"))}e.stopPropagation()},!1),Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}},i.probillerAjax=function(e,a,l,r){MG_Utils.addClass(l,"disabled");var t=e.querySelector(".js-digitsError");MG_Utils.ajaxCall({url:a,type:"POST",data:r,success:function(e){e.error?t.innerHTML=e.message:(t.innerHTML="",mixpanel.identify(e.MixpanelEvent.userId),mixpanel.track(e.MixpanelEvent.eventName,e.MixpanelEvent.event),MG_Utils.addClass(l,"disabled"),window.location.href=e.redirectUrl),l.removeAttribute("disabled")}})},i.digitsValidation=function(e,a,l){a.preventDefault();var r=e.querySelector(".js-purchaseDigitsModal");if(MG_Utils.hasClass(l,"js-purchaseVideoDigitsButton")){var t=r.querySelectorAll("input"),s=[];if([].forEach.call(t,function(e){""==e.value?(s=[],MG_Utils.addClass(e,"fail")):(MG_Utils.removeClass(e,"fail"),s.push(e.value))}),r.querySelectorAll("input.fail").length)r.querySelector(".js-digitsError").innerHTML=i.params.digitsError,l.removeAttribute("disabled");else{var o={last4:s.join("")};i.probillerAjax(r,i.params.probillerUrl,l,o)}}else i.probillerAjax(e,i.params.probillerUrl,l)},i.handleAfterLoginSignup=function(e,a,l){l=void 0!==l&&l,void 0!==a.liuIsOwner&&a.liuIsOwner?window.location.reload(!0):(void 0!==a.newToken&&a.newToken&&(i.params.token=a.newToken),l?(purchaseFlow_Utils.openSelectedModal(".last_digits_modal",e),i.addLastDigitsModalListeners(e),e.querySelector(".last_digits_top_username").innerHTML=a.username,e.querySelector(".last_digits_avatar").setAttribute("src",a.avatar),MG_Utils.addClass(e,"leave_confirmation"),MG_Utils.addClass(e.querySelector(".js_confirm_leave_modal"),"reload_on_close"),void 0!==a.dismissUrl&&(i.params.dismissUrl=a.dismissUrl),void 0!==a.al&&(i.params.premiumUserInfo=a.al)):void 0!==a.alreadyBought&&a.alreadyBought?(purchaseFlow_Utils.openSelectedModal(".js-alreadyBoughtModal",e),MG_Utils.removeClass(e,"leave_confirmation"),MG_Utils.addClass(e,"reload_on_close"),void 0!==a.dismissUrl&&(i.params.dismissUrl=a.dismissUrl),void 0!==a.profileUrl&&e.querySelector(".js_alreadyBought").setAttribute("data-url",a.profileUrl),MG_Utils.addEventHandler(e.querySelector(".js_alreadyBought"),"click",function(e){i.purchaseFlowModal.closeModal(function(){window.location.href=e.target.getAttribute("data-url")})})):void 0!==a.redirectUrl&&(window.location.href=a.redirectUrl))},i.addLastDigitsModalListeners=function(s){var e=s.querySelectorAll(".lastFour");[].forEach.call(e,function(e){["keyup","input","keypress"].forEach(function(r){MG_Utils.addEventHandler(e,r,function(e){"input"==r&&1<=e.target.value.length&&(e.target.value=e.target.value.slice(0,1),MG_Utils.hasClass(e.target,"lastFourEnd")||e.target.nextElementSibling.focus());var a=s.querySelector("."+purchaseFlow_Utils.getCurrentOpenedModal(s)),l="";[].forEach.call(a.querySelectorAll(".lastFour"),function(e){l+=e.value}),"input"==r&&4==l.length&&MG_Utils.removeClass(a.querySelector(".js_last_digits_submit"),"disabled"),"keyup"!=r||"13"!=e.keyCode||MG_Utils.hasClass(a.querySelector(".js_last_digits_submit"),"disabled")||i.handleLastDigitsAjax(a,l)})})});var a=s.querySelectorAll(".js_last_digits_submit");[].forEach.call(a,function(t){MG_Utils.addEventHandler(t,"click",function(e){if(!MG_Utils.hasClass(t,"disabled")){var a=e.target.parentElement;MG_Utils.addClass(t,"disabled");var l="";a.querySelectorAll(".lastFour").forEach(function(e){l+=e.value});var r=s.querySelector("."+purchaseFlow_Utils.getCurrentOpenedModal(s));i.handleLastDigitsAjax(r,l)}})});var l=s.querySelectorAll(".js_change_cc");[].forEach.call(l,function(e){MG_Utils.addEventHandler(e,"click",function(e){MG_Utils.ajaxCall({type:"POST",data:{token:i.params.token},url:i.params.probillerCreditCard,success:function(e){"PASS"==e.success&&(window.location.href=e.redirectUrl)}})})})},i.handleLastDigitsAjax=function(a,e){MG_Utils.removeClass(a.querySelector(".last_digits_error"),"active"),a.querySelector(".last_digits_error").innerHTML="";var l={last4:e,token:i.params.token};i.params.premiumUserInfo&&(l.al=i.params.premiumUserInfo),MG_Utils.ajaxCall({type:"POST",data:l,url:i.params.probillerUrl,success:function(e){"FAIL"==e.success||e.error?(MG_Utils.addClass(a.querySelector(".last_digits_error"),"active"),a.querySelector(".last_digits_error").innerHTML=e.message):window.location.href=e.redirectUrl}})}};try{var videoPurchaseFlow=new VideoPurchaseFlow;videoPurchaseFlow.init("undefined"!=typeof Video_PurchaseFlow_Params?Video_PurchaseFlow_Params:{})}catch(e){console.log("ERROR === Video Purchase Flow ==="),console.log(e)}