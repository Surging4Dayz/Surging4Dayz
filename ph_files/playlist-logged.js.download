var currentVkey,tagModal=[],numberofPl=playlists.length;function forwardVideoKeyForNewPlaylist(e){var t,a=document.querySelectorAll(".playlist-modal");for(t=0;t<a.length;t++)a[t].setAttribute("data-vkey",e)}function matchInArray(e,t){var a,l=!1;for(a=0;a<e.length&&!(l=t(e[a]));a++);return l}function slideReveal(e){var t,a,l=0;e.style.height="",e.style.position="relative",e.style.zIndex="-1",e.style.display="block",a=parseInt(getStyle(e,"height")),e.style.height="0",e.style.position="",e.style.zIndex="0",t=setInterval(function(){parseInt(getStyle(e,"height"))<a?(l+=1,e.style.height=l+"px"):clearInterval(t)},30)}function slideHide(e){var t,a=parseInt(getStyle(e,"height"));e.style.overflow="hidden",t=setInterval(function(){0<parseInt(getStyle(e,"height"))?(a-=1,e.style.height=a+"px",0<parseInt(getStyle(e,"padding"))&&(e.style.padding=parseInt(getStyle(e,"padding"))-1+"px")):(clearInterval(t),e.style.zIndex="",e.style.display="",e.style.padding="")},30)}function getStyle(e,t){return window.getComputedStyle?getComputedStyle(e,"")[t]:e.currentStyle?e.currentStyle[t]:void 0}function fadeIn(e){e.style.opacity=0,e.style.display="block";var t,a=10*+getStyle(e,"opacity");clearInterval(t),t=setInterval(function(){a<10?(a++,e.style.opacity=(a/10).toFixed(1)):(clearInterval(t),t=0)},50)}function findInArray(e,t){for(var a=t.length,l=0;l<a;l++)if(t[l]==e)return l;return-1}function setupNewPListCreation(){var e=document.getElementsByTagName("BODY")[0];MG_Utils.addEventHandler(e,"click",function(e){var t,a=document.getElementById("js-tagsListModal"),l=l=(e=e||window.event).target||e.srcElement;if("add-playlist"===l.getAttribute("id")){MG_Utils.preventDefault(e),dropdown.init("#playlist-form .subFilter"),t="undefined"!=typeof vKeyAddVideo?vKeyAddVideo:document.querySelector(".playlist-modal").getAttribute("data-vkey");var i=document.getElementById("new-playlist-title").value.sanitizeMultilingual(),s=document.getElementById("new-playlist-description").value.sanitizeMultilingual(),d=document.querySelector(".createPlaylistContainer")?document.querySelector(".createPlaylistContainer").querySelector("#new-playlist-privacy"):document.getElementById("new-playlist-privacy");privacy=d.querySelector("ul.filterListItem li.active").getAttribute("data-value"),errorMsg=document.getElementById("playlist-form").querySelector(".error");var n=validateBannedWords(i),r=validateBannedWords(s);document.getElementById("new-playlist-title").value=i,document.getElementById("new-playlist-description").value=s,i&&a.value.length?n&&r?(document.getElementById("add-playlist").setAttribute("disabled","disabled"),modal_hide_timeout=!0,MG_Utils.ajaxCall({url:WIDGET_PLAYLIST_HEADER.urlNewPL,type:"POST",dataType:"text/html",data:{title:i,tags:a.value,description:s,vkey:t,status:privacy,token:token},success:function(e){document.getElementById("playlist-form").style.display="none";var t=document.createElement("div"),a=document.getElementById("modalWrapMTubes").querySelector(".playlist-modal"),l=a.querySelector(".modal-title");t.className="succesMsg","spam"==e?(l.innerHTML=WIDGET_PLAYLIST_HEADER.errorDescriptionToManyUrls+"!",MG_Utils.addClass(l,"failureRed"),MG_Utils.setText(t,i+" "+WIDGET_PLAYLIST_HEADER.errorCouldNotCreate)):"error_vkey"==e?(l.innerHTML=WIDGET_PLAYLIST_HEADER.errorNoVideo+"!",MG_Utils.addClass(l,"failureRed"),MG_Utils.setText(t,i+" "+WIDGET_PLAYLIST_HEADER.errorCouldNotCreate)):"forbidden"==e?(l.innerHTML=WIDGET_PLAYLIST_HEADER.errorCantCreate+"!",MG_Utils.addClass(l,"failureRed"),MG_Utils.setText(t,WIDGET_PLAYLIST_HEADER.errorForbiddenWords)):(l.innerHTML=WIDGET_PLAYLIST_HEADER.successNewPlaylist+"!",MG_Utils.addClass(l,"successGreen"),MG_Utils.setText(t,WIDGET_PLAYLIST_HEADER.successVideoAdded+": "+i)),a.appendChild(t),setTimeout(function(){location.reload()},2e3)}}).fail(function(){clearModalPlaylist()})):(MG_Utils.setText(errorMsg,WIDGET_PLAYLIST_HEADER.errorForbiddenWords),errorMsg.style.display="block"):(MG_Utils.setText(errorMsg,WIDGET_PLAYLIST_HEADER.errorMissingInfo),errorMsg.style.display="block")}})}function isTagSTooShort(e){return e.length<3}function clearModalPlaylist(){void 0!==tagModal&&(tagModal=[]),document.getElementById("playlist-form").querySelector(".error").style.display="none";var e=document.getElementById("modalWrapMTubes").querySelector(".playlist-modal"),t=e.querySelector(".modal-title"),a=e.querySelector(".succesMsg");MG_Utils.removeClass(t,"successGreen"),t.innerHTML=WIDGET_PLAYLIST_HEADER.createPL,a&&a.parentNode.removeChild(a),document.getElementById("add-playlist").removeAttribute("disabled")}function favoritePlaylist(e,t){var a=document.querySelector(".favPlaylist"),l=document.getElementById("favoritePlaylist");MG_Utils.hasClass(a,"favorited")?MG_Utils.ajaxCall({url:WIDGET_PLAYLIST_HEADER.urlRemoveFavoritePL,type:"GET",data:{playlist_id:e,token:t},success:function(e){MG_Utils.removeClass(a,"favorited"),l&&l.setAttribute("data-title",WIDGET_PLAYLIST_HEADER.favoritePL)}}):MG_Utils.ajaxCall({url:WIDGET_PLAYLIST_HEADER.urlFavoritePL,type:"GET",data:{playlist_id:e,token:t},success:function(e){if(1==e)MG_Utils.addClass(a,"favorited"),l&&l.setAttribute("data-title",WIDGET_PLAYLIST_HEADER.alreadyInFavorite);else{var t=document.querySelector(".errorMessage");"block"!==getStyle(t,"display")&&(slideReveal(t),setTimeout(function(){slideHide(t)},5e3))}}})}function removePlFromFavorite(e,a){MG_Utils.ajaxCall({url:WIDGET_PLAYLIST_HEADER.urlRemoveFavoritePL,type:"GET",data:{playlist_id:e},success:function(e){var t=document.getElementById(a);t.parentNode.removeChild(t)}})}function playlistAppend(){if("undefined"!=typeof playlists){var t,a,l=document.getElementById("addToPlaylist");l&&playlists.forEach(function(e){(a=document.createElement("a")).href="javascript:",a.className="playlist-add-video",a.setAttribute("_id",e.id),MG_Utils.setText(a,e.title),(t=document.createElement("li")).appendChild(a),l.appendChild(t)})}}function playlistAppendAsc(){if("undefined"!=typeof playlistsByTitleAsc){var t,a,l=document.getElementById("changePlaylist");l&&playlistsByTitleAsc.forEach(function(e){(a=document.createElement("a")).href="/view_video.php?viewkey="+e.video_vkey+"&pkey="+e.id,MG_Utils.setText(a,e.title),(t=document.createElement("li")).appendChild(a),l.appendChild(t)})}}function setupPListEvents_WatchPage(){var e=document.getElementById("custom-playlist-detailed")?document.getElementById("custom-playlist-detailed"):document.querySelectorAll(".custom-playlist-detailed");if(e)if(document.getElementById("custom-playlist-detailed"))playlistEvents(e);else for(var t=0;t<e.length;t++)playlistEvents(e[t])}function playlistEvents(e){MG_Utils.addEventHandler(e,"click",function(e){var t,a,l=(e=e||window.event).target||e.srcElement;if(l&&"LI"==l.nodeName){var i=l.getElementsByTagName("A")[0];"playlist-add-watchlater-viewpage"===i.getAttribute("id")?a=i:MG_Utils.hasClass(i,"playlist-add-video-viewpage")&&(t=i)}else!l||"SPAN"!=l.nodeName&&"VAR"!=l.nodeName?l&&"A"==l.nodeName&&(t=MG_Utils.hasClass(l,"playlist-add-video-viewpage")?l:null,a="playlist-add-watchlater-viewpage"===l.getAttribute("id")?l:null):(t=l.closest(".playlist-add-video-viewpage")?l.closest(".playlist-add-video-viewpage"):null,a=l.closest("#playlist-add-watchlater-viewpage")?l.closest("#playlist-add-watchlater-viewpage"):null);if(t){var s,d=this.getAttribute("_vkey"),n=t.getAttribute("_id");for(s=0;s<numberofPl;s++)if(n==playlists[s].id)if(1==playlists[s].isFull)alert(WIDGET_PLAYLIST_HEADER.warningMaxVideos+".");else{var r=t.closest("li");if(MG_Utils.hasClass(r,"saved"))fadeIn(t.querySelector(".alreadyInPlaylistMessage"));else{var o=t.getAttribute("data-videoid");MG_Utils.ajaxCall({url:WIDGET_PLAYLIST_HEADER.urladdToPL,type:"GET",data:{type:"playlist",playlist_id:n,vkey:d,token:token},success:function(e){(document.getElementById("watchLaterCount_"+o)?document.getElementById("watchLaterCount_"+o):t.querySelector(".watchLaterCount_"+o)).innerHTML=e.videos_count}}),MG_Utils.addClass(r,"saved"),fadeIn(t.querySelector(".savedToPlaylistMessage"))}}}if(a)if(1==watchLaterFull)alert(WIDGET_PLAYLIST_HEADER.warningMaxVideos+".");else{d=this.getAttribute("_vkey"),r=a.closest("li");MG_Utils.hasClass(r,"saved")?fadeIn(a.querySelector(".alreadyInPlaylistMessage")):(MG_Utils.ajaxCall({url:WIDGET_PLAYLIST_HEADER.urladdToPL,type:"GET",data:{type:"watchlater",vkey:d,token:token},success:function(e){document.getElementById("watchLaterCount").innerHTML=e.videos_count}}),MG_Utils.addClass(r,"saved"),fadeIn(a.querySelector(".savedToPlaylistMessage")))}})}function setupPListEvents_VideoThumbs(){var e=document.querySelector(".watchlater-add");e&&MG_Utils.addEventHandler(e,"click",addToWatchLater);var t=document.getElementById("addToPlaylist");t&&MG_Utils.addEventHandler(t,"click",addToCustomPL)}function addToWatchLater(e){MG_Utils.preventDefault(e);var t=vKeyAddVideo,a=document.querySelector('[_vkey="'+t+'"]'),l=a.querySelector("img").getAttribute("src"),i=a.querySelector(".premiumIcon")?"1":"0",s=this;if(1==watchLaterFull)alert(WIDGET_PLAYLIST_HEADER.warningMaxVideos+".");else if(!MG_Utils.hasClass(this,"added")&&(MG_Utils.ajaxCall({url:WIDGET_PLAYLIST_HEADER.urladdToPL,type:"GET",data:{type:"watchlater",vkey:t,token:token},success:function(e){var t=s.closest(".quicklick");MG_Utils.addClass(t,"added")}}),playlist_menu_fadeout(s),"undefined"!=typeof playlistId&&"undefined"!=typeof videosVkeys&&-1===findInArray(t,videosVkeys))){var d,n,r;if(videos.push({privacy:"public",premium:i,rating:currentRating,vkey:t,smallThumb:currentThumb,xSmallThumbNew:l,title:currentTitle,durationFormatted:currentDuration}),"undefined"!=typeof originalShuffleStatus&&1==originalShuffleStatus||"undefined"!=typeof shuffleStatus&&1==shuffleStatus){var o=getCookie("playlistShuffle_"+playlistId).split(",");o.push(t),o.sort(function(){return.5-Math.random()});var u=o.join(",")+"path=/;";setCookie("playlistShuffle_"+playlistId,u),shuffledNextVkey=o[getNextPosition(currentVkey,o)],shuffledPrevVkey=o[getPrevPosition(currentVkey,o)]}else videosVkeys.push(t),nextVkey=videosVkeys[getNextPosition(currentVkey,videosVkeys)];if(d=videos.length-1,writeDetailItem(d,videos),$j(".carousel-navigation").jcarousel("reload"),(n=document.querySelectorAll(".carousel-navigation li"))&&3<n.length){for(r=0;r<n.length;r++)MG_Utils.removeClass(n[r],"last");MG_Utils.addClass(n[n.length-1],"last")}}}function addToCustomPL(e){var a,t,l,i=i=(e=e||window.event).target||e.srcElement,s=vKeyAddVideo,d=document.querySelector('[_vkey="'+s+'"]'),n=d.querySelector("img").getAttribute("src"),r=d.querySelector(".premiumIcon")?"1":"0";if(i&&"A"==i.nodeName&&(a=MG_Utils.hasClass(i,"playlist-add-video")?i:null),a)for(t=a.getAttribute("_id"),l=0;l<numberofPl;l++){var o;if(t==playlists[l].id)if(1==playlists[l].isFull)alert(WIDGET_PLAYLIST_HEADER.warningMaxVideos+".");else if(!MG_Utils.hasClass(a,"added"))if(MG_Utils.ajaxCall({url:WIDGET_PLAYLIST_HEADER.urladdToPL,type:"GET",data:{type:"playlist",playlist_id:t,vkey:s,token:token},success:function(e){var t=a.closest("li");MG_Utils.addClass(t,"added")}}),playlist_menu_fadeout(this),"undefined"!=typeof playlistId)if(playlistId==t)if("undefined"!=typeof videosVkeys&&-1===findInArray(s,videosVkeys)){if(videos.push({rating:currentRating,premium:r,vkey:s,xSmallThumbNew:n,smallThumb:currentThumb,title:currentTitle,durationFormatted:currentDuration}),"undefined"!=typeof originalShuffleStatus&&1==originalShuffleStatus||"undefined"!=typeof shuffleStatus&&1==shuffleStatus){var u=getCookie("playlistShuffle_"+playlistId).split(",");u.push(s),u.sort(function(){return.5-Math.random()});var c=u.join(",")+"path=/;";setCookie("playlistShuffle_"+playlistId,c),shuffledNextVkey=u[getNextPosition(currentVkey,u)],shuffledPrevVkey=u[getPrevPosition(currentVkey,u)]}else videosVkeys.push(s),nextVkey=videosVkeys[getNextPosition(currentVkey,videosVkeys)];if(o=videos.length-1,writeDetailItem(o,videos),$j(".carousel-navigation").jcarousel("reload"),carouselItems=document.querySelectorAll(".carousel-navigation li"),carouselItems&&3<carouselItems.length){for(l=0;l<carouselItems.length;l++)MG_Utils.removeClass(carouselItems[l],"last");MG_Utils.addClass(carouselItems[carouselItems.length-1],"last")}}}}var displayErrorModal=function(e){var t=document.getElementById("tagErrorDisplayModal");t.innerHTML="";var a=document.createElement("span");a.className="tagListError",a.textContent=e,t.appendChild(a)},handleTagDisplayModal=function(e){var t='<li class="tagButton"><div class="labelTag removeTagButtonModal"></div><div class="labelText removeTagButtonModal"><span class="tagText removeTagButtonModal">'+e+'</span><span class="labelIcon removeTagButtonModal"></span></div></li>';document.getElementById("tagListModal").innerHTML+=t},handleRemoveTagModal=function(e){var t=e.target;if(MG_Utils.hasClass(t,"removeTagButtonModal")){e.preventDefault();var a=t.parentNode.textContent,l=tagModal.indexOf(a);0<=l&&tagModal.splice(l,1),tagModal.toString().replace(/(,|\s)/g,"").length<150&&(document.getElementById("tagErrorDisplayModal").innerHTML=""),document.getElementById("tagListModal").innerHTML="",tagModal.forEach(handleTagDisplayModal);var i=document.getElementById("js-tagsListModal"),s=tagModal.join("|");i.value=s.replace(/\s/gi,"+")}},handleAddTagModal=function(e){var t=e.target;if(MG_Utils.hasClass(t,"js-addTagModal")){e.preventDefault();var a=document.getElementById("addTagInputModal");if(a.value=a.value.replace(/[^a-zA-Z0-9 ]/g,"").trim(),a.value.length<3)return displayErrorModal('Tag "'+a.value+'" not valid. Must contain a minimum of 3 characters!');if(20<a.value.length)return displayErrorModal('Tag "'+a.value+'" not valid. Tags are maximum 20 characters!');if(-1<tagModal.map(function(e){return e.toLowerCase()}).indexOf(a.value.toLowerCase()))return displayErrorModal("No duplicate tags allowed!");if(!validateBannedWords(a.value.toLowerCase(),bannedWords))return displayErrorModal('Tag "'+a.value+'" is considered to be a banned word.');document.getElementById("tagListModal").innerHTML="",tagModal.push(a.value);var l=tagModal.toString().replace(/(,|\s)/g,"");if(150<l.length){var i=tagModal.indexOf(a.value);0<=i&&tagModal.splice(i,1)}tagModal.forEach(handleTagDisplayModal),document.getElementById("tagErrorDisplayModal").innerHTML="",150<l.length&&displayErrorModal("You have reached the maximum tag limit.");var s=document.getElementById("js-tagsListModal"),d=tagModal.join("|");s.value=d.replace(/\s/gi,"+"),a.value=""}},handleKeyPressModal=function(e){var t=e.target;if(MG_Utils.hasClass(t,"js-addTagInputModal")&&188==(e.keyCode?e.keyCode:e.which)){var a=document.getElementById("addTagInputModal");a.value=a.value.replace(/,/g,""),document.getElementById("addTagModal").click()}},clearTagsModal=function(e){var t=e.target;(MG_Utils.hasClass(t,"buttonMTubes")||MG_Utils.hasClass(t,"createPlaylistContainer"))&&void 0!==tagModal&&(tagModal=[])};document.addEventListener("click",handleRemoveTagModal),document.addEventListener("click",handleAddTagModal),document.addEventListener("keyup",handleKeyPressModal),document.addEventListener("click",clearTagsModal),MG_Utils.domReady(function(){playlistAppend(),playlistAppendAsc(),setupPListEvents_WatchPage(),setupPListEvents_VideoThumbs(),setupNewPListCreation()});